version: '{build}'
environment:
  launcherVersion: 3.2.1

init:
- ps: >-
    Get-ChildItem env:

    $commitHash       = "$($env:APPVEYOR_REPO_COMMIT.Substring(0, 7))"

    $env:buildVersion = "$env:launcherVersion-$commitHash"

    $env:nugetVersion = "$env:launcherVersion-beta.$env:APPVEYOR_BUILD_NUMBER"
    
    Update-AppveyorBuild -Version $env:buildVersion

assembly_info:
  patch: true
  file: SolutionAssemblyInfo.cs
  assembly_version: $(launcherVersion)
  assembly_file_version: $(launcherVersion)
  assembly_informational_version: $(launcherVersion)
dotnet_csproj:
  patch: true
  file: 'Flow.*\*.csproj'
  version: $(nugetVersion)
  package_version: $(nugetVersion)
  assembly_version: $(nugetVersion)
  file_version: $(nugetVersion)
  informational_version: $(nugetVersion)

skip_commits:
  files:
    - '*.md'

image: Visual Studio 2019
configuration: Release
platform: Any CPU
before_build:
- ps: nuget restore
build:
  project: Flow.Launcher.sln
  verbosity: quiet

artifacts:
- path: 'Output\Packages\*'
- path: 'Output\Release\Flow.Launcher.Plugin.*.nupkg'
  name: Plugin nupkg
- path: 'Output\Release\Flow.Launcher.Plugin.*.snupkg'
  name: Plugin snupkg